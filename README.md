# Liunx

 - VMware (Workstation Pro)
  - CentOS 8 liunx版本
    - 安装向导
      - 自定义
      - 安装映像文件
      - CPU核数根据实际CPU核数、内存最小设置为2G、网络设为桥接
      - 将虚拟磁盘存储为单个文件
      - 完成配置后启动VMware进行安装Liunx
      - intel-v 没启动：进入BOIS 启动`virtual internel technology`
      - pane is dead：CD/DVD 均路径指向Liunx镜像文件
      - 指定硬件位置（必须点击，否则无法下一步）
      - 网络配置：IPV4设为自动（DHCP）保存即显示连接状态
      - root 密码设置为123456等弱密码时点击两次确定即可
 - liunx 常用指令
    - `curl -O https://***` 下载资源
    - `pwd` 查看当前路径
    - `ls` 列出文件
    - `ll` 列出文件与权限
    - `:wq` 保存并关闭
    - `:q!` 不保存并关闭
    - `:q`  直接关闭
    - `rm -rf` 删除文件夹
    - `-p` 操作根目录
    - `mv` 移动文件
    - `tar -xvf` 解压
 - liunx 安装插件
   - 切换为root用户
    - yum：CentOS中的Shell前端软件包管理器，默认系统已安装。安装方法：https://rpm.nodesource.com/ 
    - nodejs 安装步骤： 
      - 添加源：`curl -sl https://rpm.nodesource.com/setup_11.x | bash -`
      - 全局安装：`yum install -y nodejs`
      - 查看 `node -v / npm -v`
    - sublime 安装步骤：
      - liunx 内官网下载liunx版本
      - 解压缩 `tar -xvvf sublime_text_3_build_**_tar.ba`
      - 移动到 opt `mv sublime_text_3 /opt/`
      - 复制快速启动文件到系统菜单目录 `cp /opt/sublime_text_3/sublime_text.desktop /usr/share/applications`
      - 开打文件 `vim /usr/share/applications/sublime_text.desktop`
      - 配置快速启动 `Exec /Icon` 均改为sublime安装目录 => `/opt/sublime_text_3/sublime_text`
    - Nginx（1.16版本）
      - 优点：（负载均衡，反向代理，低消耗内存资源，动静分离[动：请求数据库，静：css/js等静态文件] ）
      - 安装Nginx依赖包：`yum -y install gcc zlib zlib-devel pcre-devel make cmake openssl openssl-devel`
      - liunx 内官网下载Nginx(稳定版)： `http://nginx.org/`
      - 解压Nginx.**.tar.gz，解压后文件夹内执行`./configure`检查
      - 执行（当make没定义需安装）：`make && make  install`
      - 查看是否安装成功并启动：`/usr/local/nginx/sbin/` => `./nginx`
      - 查看是否启动成功：`ps -ef | grep nginx`
      - 防火墙设置（不设置防火墙的port, 外部无法访问）
        - 查看防火墙：`firewall-cmd --list-all`
        - 设置外部可访问端口：`fire-wall --add-port=80/tcp --permanent`
        - 重启防火墙：`firewall-cmd --reload`
       - `/usr/local/nginx/sbin/nginx` 启动Nginx
       - `/usr/local/nginx/sbin/nginx -s quit` 待Nginx进程处理完毕任务后停止
       - `/usr/local/nginx/sbin/nginx -s stop` 查出Nginx进程再使用kill命令强制杀掉进程
      - 文件目录 `/usr/local/nginx/html`
      - 配置服务器：`/usr/local/nginx/conf/nginx.conf`
        - `worker_processes` 设置CPU核数处理高并发
        - `worker_connections` 最大并发数量
        - http
          - `local_format` 设置日志格式
          - `access_log` 访问日志
          - `keepalive_timeout` 超时时间
          - `gzip` 压缩
          - `proxy_cache_path` 启动缓存设置
          - upstream 负载均衡
          - server
            - 404 页面配置
            - location / （可以另添加其他路由设置：location /img 等）
              - `add_header Cache-Control max-age=3600` 缓存浏览器而请求服务端返回304
              - `expires` 缓存浏览器而不请求服务端（s/秒, m/分， h/时, d/天, y/年）
              - `etag` on/off
              - `deny` 访问权限：禁止指定IP访问或者全部（all）
              - `allow` 访问权限：允许指定IP访问或者全部（all）
              - `proxy_pass` 反向代理的到指定的服务器
              - `proxy_cache_purge` 访问指定路由手动删除缓存
          - 虚拟主机：将一个服务器主机划分为多个主机称为虚拟主机（`/usr/local/nginx/conf/nginx.conf`中server），以端口区分
      - 根据终端显示对应的页面（PC or Moblie）
   - mongodb （3.6.17）
     - 解压压缩包并移动到 `/usr/local/mongodb`
     - 创建数据存放目录 `mkdir -p /data/mongodb`
     - 启动mongodb： 1.进入指定目录 `/usr/local/mongodb/bin`, 2.启动并指定端口、存放数据路径 `./mongod --port 27017 --dbpath=/data/mongodb`
     - 查看MongoDB是否启动 `ps -ef | grep mongodb`
     - 进入操作数据库命令环境：1.进入指定目录 `/usr/local/mongodb/bin` , 2.启动 `./mongo`
     - 增/批量增（insert） `db.collection.insert({})` or  `db.collection.insert([{}, {}])`
     - 更新对象（update） `db.collection.update({}, {$set: {}}, {multi: true, upsert: true})`，`$set`更新的键值，`multi`为全数据更新（默认更新第一条），`upsert`为没当数据时直接插入
     - 更新数组
        - `$addToSet` 当值不存在时添加值到数组，否则不添加
        - `$each` 批量添加值
        - `$pop` 删除数组首/尾值
        - `$pull` 删除数组指定键；通过$set把指定键设为 null 通过 $pull 过掉数组
     - findAndModify 
        - * `findAndModify ` 有返回值，$update是没有的，速度比$update稍慢，但是建议使用该函数更新/删除 *
        - * `runCommand()` 执行mongoDB中的特殊函数,findAndModify就是特殊函数之一,他的作用是返回update或remove后的文档 *
     - 查询/多条件查询 （find）
        - $in 查询一键多值（包含） `$in: [*, *]`
        - $or 查询多键多值(或) `$or: [{age: 12}, {name: 'devin'}]`
        - $and 查询多键多值（且） `$and: [{age: 12}, {name: 'devin'}]`
        - $en / $lte / $lt / $gte / $gt； 大于、小于、不等于 
        - 数组中`$all`代表并 `$in`代表或
     - 搜索文本含指定字段 `$search`
     - 输出状态 `db.collection.stats()`
     - 高性能搜索/更新数据 `db.collection.createIndex({})`
     - 删除 (drop)
   - ab并发压力测试
   - keepalived 为Nginx添加健壮性（当主Nginx服务器奔溃时，直接连接备用Nginx）
